title Health Management System

// Define Person entity (shared attributes)
person {
  person_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  first_name varchar(100) NOT NULL,
  last_name varchar(100) NOT NULL,
  date_of_birth timestamp with time zone,
  gender enum('male', 'female', 'other'),
  contact_info varchar(255),
  address text,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL
}

// Define Employees entity (inherits from Person)
employees {
  employee_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  person_id int NOT NULL UNIQUE,
  position varchar(100),
  department varchar(100),
  hire_date timestamp with time zone,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  FOREIGN KEY (person_id) REFERENCES person (person_id)
}

// Define Doctors entity (inherits from Employees)
doctors {
  doctor_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  employee_id int NOT NULL UNIQUE,
  specialization_id int,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  FOREIGN KEY (employee_id) REFERENCES employees (employee_id),
  FOREIGN KEY (specialization_id) REFERENCES specializations (specialization_id)
}

// Define Specializations entity
specializations {
  specialization_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  specialization_name varchar(100) NOT NULL UNIQUE,
  description text,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL
}

// Define Branches entity
branches {
  branch_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  branch_name varchar(100) NOT NULL UNIQUE,
  address text,
  contact_info varchar(255),
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL
}

// Define Available_Reservations entity
available_reservations {
  reservation_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  branch_id int NOT NULL,
  doctor_id int NOT NULL,
  patient_id int NOT NULL,
  reservation_date timestamp with time zone,
  reservation_time time,
  status enum('available', 'booked', 'cancelled'),
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  FOREIGN KEY (branch_id) REFERENCES branches (branch_id),
  FOREIGN KEY (doctor_id) REFERENCES doctors (doctor_id),
  FOREIGN KEY (patient_id) REFERENCES patients (patient_id)
}

// Define Tasks entity
tasks {
  task_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  task_name varchar(100) NOT NULL UNIQUE,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL
}

// Define Scheduled_Tasks entity (formerly Upcoming_Tasks)
scheduled_tasks {
  task_id int NOT NULL,
  patient_id int NOT NULL,
  scheduled_date timestamp with time zone,
  scheduled_time time,
  status enum('pending', 'completed', 'cancelled'),
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  PRIMARY KEY (task_id, patient_id),
  FOREIGN KEY (task_id) REFERENCES tasks (task_id),
  FOREIGN KEY (patient_id) REFERENCES patients (patient_id)
}

// Define Medical_History entity
medical_history {
  history_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  patient_id int NOT NULL,
  visit_date timestamp with time zone,
  diagnosis varchar(255),
  treatment varchar(255),
  notes text,
  doctor_id int,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  FOREIGN KEY (patient_id) REFERENCES patients (patient_id),
  FOREIGN KEY (doctor_id) REFERENCES doctors (doctor_id)
}

// Define Employee_Specializations entity
employee_specializations {
  employee_id int NOT NULL,
  specialization_id int NOT NULL,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  PRIMARY KEY (employee_id, specialization_id),
  FOREIGN KEY (employee_id) REFERENCES employees (employee_id),
  FOREIGN KEY (specialization_id) REFERENCES specializations (specialization_id)
}

// Define Branch_Employees entity
branch_employees {
  branch_id int NOT NULL,
  employee_id int NOT NULL,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  PRIMARY KEY (branch_id, employee_id),
  FOREIGN KEY (branch_id) REFERENCES branches (branch_id),
  FOREIGN KEY (employee_id) REFERENCES employees (employee_id)
}

// Define Invoicing entity
invoicing {
  invoice_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  patient_id int NOT NULL,
  invoice_date timestamp with time zone,
  amount numeric(10, 2),
  description text,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  FOREIGN KEY (patient_id) REFERENCES patients (patient_id)
}

// Define Roles entity for RBAC
roles {
  role_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  role_name varchar(100) NOT NULL UNIQUE,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL
}

// Define Permissions entity for RBAC
permissions {
  permission_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  permission_name varchar(100) NOT NULL UNIQUE,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL
}

// Define Role_Permissions entity for RBAC
role_permissions {
  role_id int NOT NULL,
  permission_id int NOT NULL,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  PRIMARY KEY (role_id, permission_id),
  FOREIGN KEY (role_id) REFERENCES roles (role_id),
  FOREIGN KEY (permission_id) REFERENCES permissions (permission_id)
}

// Define User_Roles entity for RBAC
user_roles {
  user_role_id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  employee_id int NOT NULL,
  role_id int NOT NULL,
  created_at timestamptz DEFAULT current_timestamp NOT NULL,
  updated_at timestamptz DEFAULT current_timestamp NOT NULL,
  FOREIGN KEY (employee_id) REFERENCES employees (employee_id),
  FOREIGN KEY (role_id) REFERENCES roles (role_id)
}

// Relationships
patients.patient_id < medical_history.patient_id
patients.patient_id < available_reservations.patient_id
patients.patient_id < scheduled_tasks.patient_id
patients.patient_id < invoicing.patient_id

doctors.doctor_id < available_reservations.doctor_id
doctors.doctor_id < medical_history.doctor_id
doctors.doctor_id < employee_specializations.employee_id

employees.employee_id < employee_specializations.employee_id
employees.employee_id < branch_employees.employee_id
employees.employee_id < user_roles.employee_id

specializations.specialization_id > employee_specializations.specialization_id

branches.branch_id > available_reservations.branch_id
branches.branch_id > branch_employees.branch_id

tasks.task_id < scheduled_tasks.task_id
